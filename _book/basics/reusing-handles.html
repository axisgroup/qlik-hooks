
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Reusing Handles Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="handle-invalidations.html" />
    
    
    <link rel="prev" href="making-api-calls.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Qlik Hooks v0.1.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Introduction
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../introduction/why-rx.html">
            
                <a href="../introduction/why-rx.html">
            
                    
                    Why Rx?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../introduction/rxq-vs-enigma.html">
            
                <a href="../introduction/rxq-vs-enigma.html">
            
                    
                    RxQ vs. Enigma
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../introduction/core-concepts.html">
            
                <a href="../introduction/core-concepts.html">
            
                    
                    Core Concepts
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Basics
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="connecting.html">
            
                <a href="connecting.html">
            
                    
                    Connecting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="making-api-calls.html">
            
                <a href="making-api-calls.html">
            
                    
                    Making API Calls
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.3" data-path="reusing-handles.html">
            
                <a href="reusing-handles.html">
            
                    
                    Reusing Handles
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="handle-invalidations.html">
            
                <a href="handle-invalidations.html">
            
                    
                    Handle Invalidations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="suspending-invalidations.html">
            
                <a href="suspending-invalidations.html">
            
                    
                    Suspending Invalidations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="closing-a-session.html">
            
                <a href="closing-a-session.html">
            
                    
                    Closing a Session
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="notifications.html">
            
                <a href="notifications.html">
            
                    
                    Notifications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="delta.html">
            
                <a href="delta.html">
            
                    
                    Delta Mode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="shortcut-operators.html">
            
                <a href="shortcut-operators.html">
            
                    
                    Shortcut Operators
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Recipes
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../recipes/connect.html">
            
                <a href="../recipes/connect.html">
            
                    
                    01. Connect to an Engine
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../recipes/engine-version.html">
            
                <a href="../recipes/engine-version.html">
            
                    
                    02. Get the Engine Version
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../recipes/multiple-global-calls.html">
            
                <a href="../recipes/multiple-global-calls.html">
            
                    
                    03. Make Multiple Global Calls
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../recipes/open-an-app.html">
            
                <a href="../recipes/open-an-app.html">
            
                    
                    04. Open an App
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../recipes/read-app-props.html">
            
                <a href="../recipes/read-app-props.html">
            
                    
                    05. Get App Properties
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../recipes/set-app-props.html">
            
                <a href="../recipes/set-app-props.html">
            
                    
                    06. Set App Properties and Listen for Changes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../recipes/gen-obj-value.html">
            
                <a href="../recipes/gen-obj-value.html">
            
                    
                    07. Calculate a Value with a GenericObject
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../recipes/current-selections.html">
            
                <a href="../recipes/current-selections.html">
            
                    
                    08. Get a stream of Current Selections
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../recipes/make-a-selection.html">
            
                <a href="../recipes/make-a-selection.html">
            
                    
                    09. Make a Selection in a Field
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="../recipes/loop-selections.html">
            
                <a href="../recipes/loop-selections.html">
            
                    
                    10. Loop through Selections in a Field
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.11" data-path="../recipes/make-lb-selections.html">
            
                <a href="../recipes/make-lb-selections.html">
            
                    
                    11. Make Selections in a Listbox
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.12" data-path="../recipes/search-lb.html">
            
                <a href="../recipes/search-lb.html">
            
                    
                    12. Search in a Listbox
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.13" data-path="../recipes/apply-patches.html">
            
                <a href="../recipes/apply-patches.html">
            
                    
                    13. Apply Patches to an Object
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.14" data-path="../recipes/get-data-page-on-invalid.html">
            
                <a href="../recipes/get-data-page-on-invalid.html">
            
                    
                    14. Get a page of data in a HyperCube on invalidation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.15" data-path="../recipes/get-pages-in-parallel.html">
            
                <a href="../recipes/get-pages-in-parallel.html">
            
                    
                    15. Get pages of data in parallel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.16" data-path="../recipes/get-pages-in-sequence.html">
            
                <a href="../recipes/get-pages-in-sequence.html">
            
                    
                    16. Get pages of data sequentially
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.17" data-path="../recipes/make-selections-on-app-open.html">
            
                <a href="../recipes/make-selections-on-app-open.html">
            
                    
                    17. Make selections on app open
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.18" data-path="../recipes/calc-time.html">
            
                <a href="../recipes/calc-time.html">
            
                    
                    18. Calculate the duration of an API call and response
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.19" data-path="../recipes/batch-invalidations.html">
            
                <a href="../recipes/batch-invalidations.html">
            
                    
                    19. Batch Invalidations with Suspend
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.20" data-path="../recipes/toggle-sessions.html">
            
                <a href="../recipes/toggle-sessions.html">
            
                    
                    20. Toggle Calculations Between Multiple Apps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.21" data-path="../recipes/offline.html">
            
                <a href="../recipes/offline.html">
            
                    
                    21. Auto-reconnect Generic Objects after a network drop
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.22" data-path="../recipes/shortcut-operators.html">
            
                <a href="../recipes/shortcut-operators.html">
            
                    
                    22. Using shortcut operators to get a layout stream
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Reusing Handles</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="reusing-handles">Reusing Handles</h1>
<p>It is common to make multiple API calls on a single Handle. Hence, we usually save off Handles in their own variable that can be reused. <a href="https://medium.com/@benlesh/hot-vs-cold-observables-f8094ed53339" target="_blank">However, Observables in RxJS are cold by default &#x2013; they create a new producer for each subscriber</a>. In RxQ land, that means that each subscriber to an API call will cause it to run. </p>
<p>Let&apos;s illustrate with an example. Assume you want to open an app and use the Doc Class to get both the app properties and the app layout. You write the following:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> { connectSession } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;rxq&quot;</span>;
<span class="hljs-keyword">import</span> { EngineVersion, OpenDoc } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;rxq/Global&quot;</span>;
<span class="hljs-keyword">import</span> { GetAppProperties, GetAppLayout } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;rxq/Doc&quot;</span>;
<span class="hljs-keyword">import</span> { switchMap } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;rxjs/operators&quot;</span>;

<span class="hljs-keyword">const</span> session = connectSession({
    host: <span class="hljs-string">&quot;localhost&quot;</span>,
    port: <span class="hljs-number">4848</span>,
    isSecure: <span class="hljs-literal">false</span>
});

<span class="hljs-keyword">const</span> doc$ = session.global$.pipe(
    switchMap(handle =&gt; handle.ask(OpenDoc))
);

<span class="hljs-keyword">const</span> appProps$ = doc$.pipe(
    switchMap(handle =&gt; handle.ask(GetAppProperties))
);

<span class="hljs-keyword">const</span> appLayout$ = doc$.pipe(
    switchMap(handle = handle.ask(GetAppLayout))
);

appProps$.subscribe(version =&gt; {
    <span class="hljs-built_in">console</span>.log(version);
});

appLayout$.subscribe(doclist =&gt; {
    <span class="hljs-built_in">console</span>.log(doclist);
});
</code></pre>
<p>In the code above, we execute two API calls leveraging the <code>doc$</code> Observable. This Observable is getting two subscribers via the <code>appProps$</code> and <code>appLayout$</code> subscriptions. <strong>Therefore, this will execute the <code>doc$</code> Observable twice, running the OpenDoc command twice!</strong> This is rarely what we want when working with QAE, especially when creating new Generic Objects. Instead, we want to share the Handle across subscribers. This can be done by multicasting the Handle Observable.</p>
<p><a href="https://blog.angularindepth.com/rxjs-understanding-the-publish-and-share-operators-16ea2f446635" target="_blank">There are many ways to multicast Observables in RxJS.</a> For RxQ usage, we often find the operator <code>shareReplay(1)</code> does the trick for us. This operator:</p>
<ul>
<li>will create the Observable producer when going from 0 to 1 observers</li>
<li>will share the latest seen value with any late subscribers</li>
</ul>
<p>In most RxQ examples, you will see reused handles written like so:</p>
<pre><code class="lang-javascript">doc$.pipe(
    shareReplay(<span class="hljs-number">1</span>)
);
</code></pre>
<p>Our example from before becomes:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> { connectSession } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;rxq&quot;</span>;
<span class="hljs-keyword">import</span> { EngineVersion, OpenDoc } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;rxq/Global&quot;</span>;
<span class="hljs-keyword">import</span> { GetAppProperties, GetAppLayout } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;rxq/Doc&quot;</span>;
<span class="hljs-keyword">import</span> { switchMap, shareReplay } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;rxjs/operators&quot;</span>;

<span class="hljs-keyword">const</span> session = connectSession({
    host: <span class="hljs-string">&quot;localhost&quot;</span>,
    port: <span class="hljs-number">4848</span>,
    isSecure: <span class="hljs-literal">false</span>
});

<span class="hljs-keyword">const</span> doc$ = session.global$.pipe(
    switchMap(handle =&gt; handle.ask(OpenDoc)),
    shareReplay(<span class="hljs-number">1</span>)
);

<span class="hljs-keyword">const</span> appProps$ = doc$.pipe(
    switchMap(handle =&gt; handle.ask(GetAppProperties))
);

<span class="hljs-keyword">const</span> appLayout$ = doc$.pipe(
    switchMap(handle = handle.ask(GetAppLayout))
);

appProps$.subscribe(version =&gt; {
    <span class="hljs-built_in">console</span>.log(version);
});

appLayout$.subscribe(doclist =&gt; {
    <span class="hljs-built_in">console</span>.log(doclist);
});
</code></pre>
<p>Now, our <code>appProps$</code> and <code>appLayout$</code> Observables will share the Global Handle produced by <code>doc$</code>. We should multicast any responses from the API that will be used by multiple observers.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="making-api-calls.html" class="navigation navigation-prev " aria-label="Previous page: Making API Calls">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="handle-invalidations.html" class="navigation navigation-next " aria-label="Next page: Handle Invalidations">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Reusing Handles","level":"1.3.3","depth":2,"next":{"title":"Handle Invalidations","level":"1.3.4","depth":2,"path":"basics/handle-invalidations.md","ref":"basics/handle-invalidations.md","articles":[]},"previous":{"title":"Making API Calls","level":"1.3.2","depth":2,"path":"basics/making-api-calls.md","ref":"basics/making-api-calls.md","articles":[]},"dir":"ltr"},"config":{"plugins":["livereload"],"root":"./docs","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"basics/reusing-handles.md","mtime":"2020-01-28T23:28:34.166Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-01-28T23:32:55.448Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

