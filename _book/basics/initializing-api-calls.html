
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Initializing API Calls Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="invalidations.html" />
    
    
    <link rel="prev" href="making-api-calls.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Qlik Hooks v0.2.1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Introduction
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../introduction/why-hooks.html">
            
                <a href="../introduction/why-hooks.html">
            
                    
                    Why Hooks?
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Basics
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="connecting.html">
            
                <a href="connecting.html">
            
                    
                    Connecting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="making-api-calls.html">
            
                <a href="making-api-calls.html">
            
                    
                    Making API Calls
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.3" data-path="initializing-api-calls.html">
            
                <a href="initializing-api-calls.html">
            
                    
                    Initializing API Calls
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="invalidations.html">
            
                <a href="invalidations.html">
            
                    
                    Invalidations
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Recipes
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../recipes/connect.html">
            
                <a href="../recipes/connect.html">
            
                    
                    01. Connect to an Engine
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../recipes/engine-version.html">
            
                <a href="../recipes/engine-version.html">
            
                    
                    02. Get the Engine Version
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../recipes/multiple-global-calls.html">
            
                <a href="../recipes/multiple-global-calls.html">
            
                    
                    03. Make Multiple Global Calls
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../recipes/open-an-app.html">
            
                <a href="../recipes/open-an-app.html">
            
                    
                    04. Open an App
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../recipes/read-app-props.html">
            
                <a href="../recipes/read-app-props.html">
            
                    
                    05. Get App Properties
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../recipes/set-app-props.html">
            
                <a href="../recipes/set-app-props.html">
            
                    
                    06. Set App Properties and Listen for Changes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../recipes/gen-obj-value.html">
            
                <a href="../recipes/gen-obj-value.html">
            
                    
                    07. Calculate a Value with a GenericObject
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../recipes/current-selections.html">
            
                <a href="../recipes/current-selections.html">
            
                    
                    08. Get a stream of Current Selections
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../recipes/make-a-selection.html">
            
                <a href="../recipes/make-a-selection.html">
            
                    
                    09. Make a Selection in a Field
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="../recipes/make-lb-selections.html">
            
                <a href="../recipes/make-lb-selections.html">
            
                    
                    10. Make Selections in a Listbox
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Initializing API Calls</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="initializing-api-calls">Initializing API Calls</h1>
<p>You&apos;ve seen in previous examples how we can call API methods with parameters, but what if we want to initialize an API call definition, but only call it when specific user interaction requires it? Let&apos;s walk through an example of when this may be the case.</p>
<h2 id="listobject">ListObject</h2>
<p>Let&apos;s progress the examples we&apos;ve seen so far to create a GenericObject in a Qlik App that contains a ListObject</p>
<pre><code class="lang-jsx"><span class="hljs-keyword">import</span> { useConnectEngine } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;qlik-hooks&quot;</span>
<span class="hljs-keyword">import</span> { useOpenDoc } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;qlik-hooks/Global&quot;</span>
<span class="hljs-keyword">import</span> { useCreateSessionObject } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;qlik-hooks/Doc&quot;</span>

<span class="hljs-keyword">const</span> Component = () =&gt; {
  <span class="hljs-keyword">const</span> engine = useConnectEngine({
    host: <span class="hljs-string">&quot;localhost&quot;</span>,
    port: <span class="hljs-number">4848</span>,
    isSecure: <span class="hljs-literal">false</span>,
  })

  <span class="hljs-keyword">const</span> doc = useOpenDoc(engine, { params: [<span class="hljs-string">&quot;Executive Dashboard.qvf&quot;</span>] })

  <span class="hljs-keyword">const</span> listObject = useCreateSessionObject(doc, {
    params: [
      {
        qInfo: { qType: <span class="hljs-string">&quot;listbox&quot;</span> },
        qListObjectDef: {
          qDef: { qFieldDefs: [<span class="hljs-string">&quot;Region&quot;</span>] },
          qInitialDataFetch: [{ qWidth: <span class="hljs-number">1</span>, qHeight: <span class="hljs-number">100</span> }],
        },
      },
    ],
  })

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>component content<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
</code></pre>
<p>We can fetch data from the ListObject using the GetLayout method, and display it as an unordered list in the jsx we return</p>
<pre><code class="lang-jsx"><span class="hljs-comment">//...</span>
<span class="hljs-keyword">import</span> { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>
<span class="hljs-keyword">import</span> { useGetLayout } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;qlik-hooks/GenericObject&quot;</span>

<span class="hljs-keyword">const</span> Component = () =&gt; {
  <span class="hljs-comment">//...</span>

  <span class="hljs-keyword">const</span> listObjectLayout = useGetLayout(listObject, { params: [] })

  <span class="hljs-keyword">const</span> [list, setList] = useState([])
  useEffect(() =&gt; {
    <span class="hljs-keyword">if</span> (listObjectLayout.qResponse !== <span class="hljs-literal">null</span>) {
      <span class="hljs-keyword">const</span> qMatrix = listObjectLayout.qResponse.qListObject.qDataPages[<span class="hljs-number">0</span>].qMatrix

      setList(
        qMatrix.map(row =&gt; ({
          label: row[<span class="hljs-number">0</span>].qText,
          value: row[<span class="hljs-number">0</span>].qElemNumber,
          state: row[<span class="hljs-number">0</span>].qState,
        }))
      )
    }
  }, [listObjectLayout])

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
        {list.map(listItem =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">li</span>
            <span class="hljs-attr">key</span>=<span class="hljs-string">{listItem.value}</span>
            <span class="hljs-attr">value</span>=<span class="hljs-string">{listItem.value}</span>
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
              <span class="hljs-attr">backgroundColor:</span> <span class="hljs-attr">listItem.state</span> =<span class="hljs-string">==</span> &quot;<span class="hljs-attr">S</span>&quot; ? &quot;#<span class="hljs-attr">2294f2</span>&quot; <span class="hljs-attr">:</span> <span class="hljs-attr">listItem.state</span> =<span class="hljs-string">==</span> &quot;<span class="hljs-attr">X</span>&quot; ? &quot;#<span class="hljs-attr">b1c0c7</span>&quot; <span class="hljs-attr">:</span> &quot;#<span class="hljs-attr">fff</span>&quot;,
            }}
          &gt;</span>
            {listItem.label}
          <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p>The next logical piece we would want to add to our ListObject is an ability to make selections when a user clicks on a list item. To do that, we need to initialize the <code>useSelectListObjectValues</code> method on our ListObject, but there&apos;s one problem, by passing in a params input, we&apos;re effectively calling the selection function with an initial state. Instead, we want to initialize the api method, and expose a way for that same method to be called whenever a user interacts with the list.</p>
<p>We can do this by not including a params option to the Qlik Hook, and instead utilizing the <code>call</code> method on the object we create from the hook.</p>
<pre><code class="lang-jsx"><span class="hljs-comment">//...</span>
<span class="hljs-keyword">import</span> { useGetLayout, useSelectListObjectValues } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;qlik-hooks/GenericObject&quot;</span>

<span class="hljs-keyword">const</span> Component = () =&gt; {
  <span class="hljs-comment">//...</span>

  <span class="hljs-keyword">const</span> selectListObjectValues = useSelectListObjectValues(listObject)

  <span class="hljs-keyword">const</span> handleListObjectSelection = value =&gt; {
    selectListObjectValues.call(<span class="hljs-string">&quot;/qListObjectDef&quot;</span>, [value], <span class="hljs-literal">true</span>)
  }

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
        {list.map(listItem =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">li</span>
            <span class="hljs-attr">key</span>=<span class="hljs-string">{listItem.value}</span>
            <span class="hljs-attr">value</span>=<span class="hljs-string">{listItem.value}</span>
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
              <span class="hljs-attr">backgroundColor:</span> <span class="hljs-attr">listItem.state</span> =<span class="hljs-string">==</span> &quot;<span class="hljs-attr">S</span>&quot; ? &quot;#<span class="hljs-attr">2294f2</span>&quot; <span class="hljs-attr">:</span> <span class="hljs-attr">listItem.state</span> =<span class="hljs-string">==</span> &quot;<span class="hljs-attr">X</span>&quot; ? &quot;#<span class="hljs-attr">b1c0c7</span>&quot; <span class="hljs-attr">:</span> &quot;#<span class="hljs-attr">fff</span>&quot;,
            }}
            <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleListObjectSelection(listItem.value)}
          &gt;
            {listItem.label}
          <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p>By doing this we don&apos;t select any values in our ListObject until a user clicks on the list.</p>
<p>This gives us an <em>almost</em> fully working ListObject, but we still aren&apos;t getting the selection state of the list items to show. Check out the next section <a href="invalidations">Invalidations</a> to see why.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="making-api-calls.html" class="navigation navigation-prev " aria-label="Previous page: Making API Calls">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="invalidations.html" class="navigation navigation-next " aria-label="Next page: Invalidations">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Initializing API Calls","level":"1.3.3","depth":2,"next":{"title":"Invalidations","level":"1.3.4","depth":2,"path":"basics/invalidations.md","ref":"basics/invalidations.md","articles":[]},"previous":{"title":"Making API Calls","level":"1.3.2","depth":2,"path":"basics/making-api-calls.md","ref":"basics/making-api-calls.md","articles":[]},"dir":"ltr"},"config":{"plugins":["livereload"],"root":"./docs","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"basics/initializing-api-calls.md","mtime":"2020-01-30T20:28:37.286Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-01-30T21:33:56.598Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

